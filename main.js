(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function r(e,n,r){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;n.addEventListener("click",(function(){return t(e)})),r.addEventListener("click",(function(){o(e),"function"==typeof c&&c()})),e.addEventListener("click",(function(t){t.target===e&&o(e)}))}e.d({},{f:()=>G}),document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated")})),document.querySelectorAll(".popup__form"),document.querySelector(".popup__button");var c=function(e,t,o){var n=e.querySelector(".popup__button");try{n.classList.remove(o.submitButton),n.classList.add(o.unactiveButtonClass)}catch(e){}},u=function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},a=function(e,t,o){var n=e.querySelector(".popup__button");t.classList.remove(o.inputSelector),t.classList.add(o.inputErrorClass);try{n.classList.remove(o.submitButton),n.classList.add(o.unactiveButtonClass)}catch(e){}e.removeEventListener("submit",G)},i=function(e,t,o){var n=e.querySelector("button");t.classList.add(o.inputSelector),t.classList.remove(o.inputErrorClass);try{n.classList.add(o.submitButton),n.classList.remove(o.unactiveButtonClass)}catch(e){}e.addEventListener("submit",G)},l=function(e,t,o){var n=/^[a-zA-Zа-яА-Я\s\-]+$/.test(t.value);""===t.value?(i(e,t,o),c(e,0,o)):!n&"url"!==t.type?(function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),n.textContent=t.dataset.text,n.classList.add(o.errorClass)}(e,t,o),a(e,t,o)):t.validity.valid?(i(e,t,o),u(e,t,o)):(function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o),a(e,t,o))},s=function(e){document.querySelectorAll(".".concat(e.formSelector)).forEach((function(t){Array.from(t.querySelectorAll(".".concat(e.inputSelector))).forEach((function(o){u(t,o,e),c(t,0,e)}))}))},p={authorization:"e5843315-a034-497e-a50e-a3a3bb2355f1","Content-Type":"application/json"};function d(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var _=function(e,t,o){return fetch("https://nomoreparties.co/v1/wff-cohort-14/users/me",{method:"PATCH",headers:p,body:JSON.stringify({name:e,about:t})}).then((function(e){d(e)})).catch((function(e){console.log(e)}))},f=function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-14/users/me/avatar",{method:"PATCH",headers:p,body:JSON.stringify(e)}).then((function(e){return d(e)})).catch((function(e){console.log(e)}))};function m(e){e.remove()}var v,y=document.querySelector(".places__list"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".profile__add-button"),q=h.querySelector(".popup__close"),L=document.querySelector('.popup__form[name="new-place"]'),b=document.querySelector(".popup_type_edit"),C=document.querySelector(".profile__edit-button"),g=b.querySelector(".popup__close"),E=document.querySelector(".popup__input_type_name"),k=document.querySelector(".popup__input_type_description"),x=document.querySelector(".popup_type_edit_avatar"),w=(document.querySelector(".popup__input_type_avatar"),document.querySelector(".profile__avatar-edit")),A=document.querySelector('.popup__form[name="avatar-profile"]'),B=(x.querySelector(".popup__button"),x.querySelector(".popup__close")),P=document.querySelector(".popup_type_image"),D=P.querySelector(".popup__image"),O=P.querySelector(".popup__caption"),T=P.querySelector(".popup__close"),j=document.querySelector(".profile__image"),N=document.querySelector(".popup__input_type_card-name"),J=document.querySelector(".popup__input_type_url"),z=(document.querySelector(".popup__input"),document.querySelectorAll(".popup__form"),document.querySelector("#card-template")),H=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),M={formSelector:"popup__form",inputSelector:"popup__input",submitButton:"popup__button",unactiveButtonClass:"popup__button_unactive",inputErrorClass:"popup__input_error",errorClass:"form__input-error_active"};function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=z.content.cloneNode(!0),c=r.querySelector(".card__title"),u=r.querySelector(".card__image"),a=r.querySelector(".card__delete-button"),i=r.querySelector(".card"),l=r.querySelector(".card__like-button"),s=r.querySelector(".like__count");c.textContent=e.name,u.src=e.link,u.alt=e.name,i.id=e._id,e&&e.likes?(s.textContent=e.likes.length,e.likes.forEach((function(e){e._id===v&&l.classList.add("card__like-button_is-active")}))):alert("cardData or cardData.likes is undefined"),u.addEventListener("click",o),l.addEventListener("click",n);var _=v;function f(){var e;(e=i.id,fetch("https://nomoreparties.co/v1/wff-cohort-14/cards/".concat(e),{method:"DELETE",headers:p}).then((function(e){return d(e)}))).then((function(){t(i)})).catch((function(e){console.log(e)}))}return void 0!==t&&(a.addEventListener("click",f),e&&e.owner&&e.owner._id!=_&&(a.removeEventListener("click",f),a.style.display="none")),r}var Z=function(e){!function(e,t,o,n,r){document.querySelectorAll(".card__image");var c=e.target,u=c.closest(".card").querySelector(".card__title");n.src=c.src,r.textContent=u.textContent,t(o)}(e,t,P,D,O)};function $(e){o(e),s(M)}function F(e){var t,o=e.target.closest(".card"),n=o.querySelector(".like__count");e.target.classList.contains("card__like-button_is-active")?(e.target.classList.remove("card__like-button_is-active"),(t=o.id,fetch("https://nomoreparties.co/v1/wff-cohort-14/cards/likes/".concat(t),{method:"DELETE",headers:p}).then((function(e){return d(e)}))).then((function(e){n.textContent=e.likes.length})).catch((function(e){console.log(e)}))):(e.target.classList.add("card__like-button_is-active"),function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-14/cards/likes/".concat(e),{method:"PUT",headers:p}).then((function(e){return d(e)}))}(o.id).then((function(e){n.textContent=e.likes.length})).catch((function(e){console.log(e)})))}function G(e){e.preventDefault();var t=e.target.querySelector("button");t.textContent="Загрузка...",_(E.value,k.value).then((function(e){H.textContent=E.value,t.textContent="Сохранить",I.textContent=k.value,$(b)})).catch((function(e){console.log(e)}))}Promise.all([fetch("https://nomoreparties.co/v1/wff-cohort-14/cards",{headers:p}).then((function(e){return d(e)})),fetch("https://nomoreparties.co/v1/wff-cohort-14/users/me",{headers:p}).then((function(e){return d(e)}))]).then((function(e){H.textContent=e[1].name,I.textContent=e[1].about,E.value=e[1].name,k.value=e[1].about,j.src=e[1].avatar,v=e[1]._id,e[0].forEach((function(e){var t=U(e,m,Z,F);y.append(t)}))})).then((function(){!function(e){Array.from(document.querySelectorAll(".".concat(e.formSelector))).forEach((function(t){!function(e,t){Array.from(e.querySelectorAll(".".concat(t.inputSelector))).forEach((function(o){l(e,o,t),o.addEventListener("input",(function(){l(e,o,t)}))}))}(t,e)}))}(M)})).catch((function(e){console.log(e)})),document.querySelector('.popup__form[name="edit-profile"]').addEventListener("submit",G),r(h,S,q),r(b,C,g,(function(){E.value=H.textContent,k.value=I.textContent})),r(P,D,T),r(x,w,B),L.addEventListener("submit",(function(e){e.preventDefault();var t,o,n={name:N.value,link:J.value},r=L.querySelector(".popup__button");r.textContent="Загрузка...",(t=n.name,o=n.link,fetch("https://nomoreparties.co/v1/wff-cohort-14/cards",{method:"POST",headers:p,body:JSON.stringify({name:t,link:o})}).then((function(e){return d(e)}))).then((function(e){var t=U(e,m,Z,F);y.prepend(t),r.textContent="Сохранить",$(h)})).catch((function(e){console.log(e)})),L.reset()})),T.addEventListener("click",(function(e){e(modalImage)})),A.addEventListener("submit",(function(e){var t=document.querySelector("#image__input_avatar");!function(e,t,o,n,r,c){e.preventDefault();var u={avatar:n.value},a=o.querySelector(".popup__form").querySelector(".popup__button");a.textContent="Загрузка...",r(u).then((function(){t.src=n.value,c(o),a.textContent="Сохранить",e.target.reset()})).catch((function(e){console.log(e)}))}(e,j,x,t,f,o)}))})();